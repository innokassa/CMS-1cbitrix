# Облачная касса Innokassa для 1С-Битрикс

Сервис Innokassa предоставляет в аренду облачные-кассы для Вашего бизнеса на различных платформах в соответствии требованиям ФЗ-54.

Для работы модуля необходима [регистрация в сервисе](https://innokassa.ru/#connection_request).

## Возможности

* Автоматическая фискализация прихода
* Обширный набор настроек
* Мультисайтовость

## Совместимость

Подходящие редакции (версия 18.0.0 и выше):
* "Малый бизнес"
* "Бизнес"

Для работы модуля требуется `php-curl`

## Установка

### Ручная

* Скачайте архив текущего репозитория
* Создайте директорию в файловой структуре вашего сайта: `bitrix/modules/innokassa.fiscal/`
* Скопируйте содержимое директории `src` (из архива) в директорию `bitrix/modules/innokassa.fiscal/`
* В админке`Marketplace` - `Установленные решения` установите модуль

## Настройки <a name="settings"></a>

![](https://innokassa.ru/modules/1cbitrix/images/settings.png)
>*Настройки модуля фискалзации*

Настройки `Группа касс`, `Актор id` и `Токен актора` выдаются клиенту после заключения договора и регистрации кассы.

Остальные параметры:
* `Налогообложение` - то что установлено на кассе (может быть несколько)
* `Адрес сайта` - то что установлено на кассе (может быть несколько)
* `Тип позиции чека по умолчанию` - для всех позиций чека, кроме доставки
* `НДС позиции чека по умолчанию` - если товарам в интернет-магазине не установлен НДС, тогда значение будет браться из этой настройки
* `НДС доставки` - для всех видов достовок
* `Создавать чек для оплаты` - фискализировать продажу только если оплата произошла через определенную систему, доступно значение "Все"
* `Схема фискализации` - типы чеков, которые необходимо пробивать в автоматическом режиме, доступные значения:
    * `Предоплата, полный расчет`
    * `Полный расчет`
* `Статус заказа для чека предоплаты` - в момент когда заказ получит указанный статус - будет пробит первый чек "предоплата"
* `Статус заказа для чека полного расчета` - в момент когда заказ получит указанный статус - будет пробит второй чек заказа "полный расчет"
* `Автоматически обрабатывать заказы только из интернет-магазина` - бывают ситуации когда в интернет-магазин заказы приходят не только через сайт, но и через 1С, если нужно обрабатывать заказы поступившие только через интернет-магазин, то необходимо отметить этот пункт

> При сохранении настроек они сверяются с данными на кассе (`Группа касс`, `Адрес сайта`, `Актор`, `Актор id`, `Налогообложение`) и в случае ошибки, настройки будут сброшены к предыдущему состоянию, а на страницу будут выведены соответствующие уведомления.

> Без корректных настроек работа модуля невозможна


## Работа модуля <a name="modulework"></a>

> Модуль работает на основании заказов, без учета отгрузок

Заказ фискализируется в автоматическом режиме на основании настроек и зависит от статуса заказа.

Все ручные операции (просмотр чеков, чек возврата, ввод кодов маркировки и прочее) осуществляются в ЛК на сайте вендора [crm.innokassa.ru](https://crm.innokassa.ru/).

> Примечание: сервер касс не всегда может провести фискализацию по запросу, поэтому модуль формирует очередь чеков на фискализацию. Если чек не был пробит в момент отправки на кассу, значит он будет пробит в ближайшее время.

> Примечание: доставки по заказу не конкретизируется, а объединяются все в одну позицию с наименованием "Доставка" и с суммированием цены всех доставок

> Примечание: модуль не фискализирует заказ при его создании, но после создания заказа можно изменить статус заказа либо повторно его сохранить для автоматической фискализации
